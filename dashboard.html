<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>工作儀表板 | OHSMS</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <style>
        :root {
            --primary-bg: #f8f9fa;
            --card-hover-transform: translateY(-5px);
        }
        body {
            background-color: var(--primary-bg);
            font-family: 'Segoe UI', 'Microsoft JhengHei', sans-serif;
            display: none; /* 權限驗證前先隱藏 */
        }
        .dashboard-card {
            border: none;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            cursor: pointer;
            height: 100%;
            border-left: 4px solid transparent; /* 左側飾條預留 */
        }
        .dashboard-card:hover {
            transform: var(--card-hover-transform);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
        }
        .card-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
            background: linear-gradient(45deg, #4f46e5, #818cf8);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .welcome-section {
            background: linear-gradient(135deg, #4f46e5 0%, #3730a3 100%);
            color: white;
            padding: 40px 0;
            margin-bottom: 30px;
            border-radius: 0 0 30px 30px;
        }
        .status-badge {
            font-size: 0.8rem;
            padding: 5px 12px;
            border-radius: 20px;
        }
    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg navbar-dark bg-dark py-3">
        <div class="container">
            <a class="navbar-brand fw-bold" href="#"><i class="fas fa-shield-alt me-2"></i>OHSMS 職業健康管理系統</a>
            <div class="d-flex align-items-center">
                <span id="nav-user-name" class="text-light me-3 small"></span>
                <button onclick="logout()" class="btn btn-outline-light btn-sm">登出</button>
            </div>
        </div>
    </nav>

    <div class="welcome-section shadow-sm">
        <div class="container text-center">
            <h1 class="display-5 fw-bold mb-2 animate__animated animate__fadeInDown">歡迎回來，<span id="display-name">使用者</span></h1>
            <p class="lead opacity-75 mb-0" id="current-time">系統載入中...</p>
        </div>
    </div>

    <div class="container mb-5">
        <div class="row g-4">
            
            <div class="col-md-6 col-lg-4" id="card-master">
                <div class="card dashboard-card p-4" onclick="window.location.href='index1.html'" style="border-left-color: #4f46e5;">
                    <div class="card-icon"><i class="fas fa-file-medical"></i></div>
                    <h4 class="fw-bold">健康資料建立</h4>
                    <p class="text-muted small">建立、查詢醫護人員與公司基本資料。 (Index 1)</p>
                </div>
            </div>

            <div class="col-md-6 col-lg-4" id="card-manager">
                <div class="card dashboard-card p-4" onclick="window.location.href='index2.html'" style="border-left-color: #10b981;">
                    <div class="card-icon" style="background: linear-gradient(45deg, #10b981, #34d399); -webkit-background-clip: text;"><i class="fas fa-clipboard-list"></i></div>
                    <h4 class="fw-bold">臨場服務紀錄</h4>
                    <p class="text-muted small">記錄護理人員臨場服務歷程、追蹤辦理事項。 (Index 2)</p>
                </div>
            </div>

            <div class="col-md-6 col-lg-4" id="card-eval">
                <div class="card dashboard-card p-4" onclick="window.location.href='index3.html'" style="border-left-color: #f59e0b;">
                    <div class="card-icon" style="background: linear-gradient(45deg, #f59e0b, #fbbf24); -webkit-background-clip: text;"><i class="fas fa-exclamation-triangle"></i></div>
                    <h4 class="fw-bold">風險評估管理</h4>
                    <p class="text-muted small">母性健康保護、過勞評估、人因工程改善管理。 (Index 3)</p>
                </div>
            </div>

            <div class="col-md-6 col-lg-4" id="card-plan">
                <div class="card dashboard-card p-4" onclick="window.location.href='index6.html'" style="border-left-color: #8b5cf6;">
                    <div class="card-icon" style="background: linear-gradient(45deg, #8b5cf6, #a78bfa); -webkit-background-clip: text;"><i class="fas fa-book-medical"></i></div>
                    <h4 class="fw-bold">指引文件維護</h4>
                    <p class="text-muted small">管理勞動部、衛生局各類健康保護指引與計畫範本。 (Index 6)</p>
                </div>
            </div>

            <div class="col-md-6 col-lg-4" id="card-maint">
                <div class="card dashboard-card p-4" onclick="window.location.href='index7.html'" style="border-left-color: #ec4899;">
                    <div class="card-icon" style="background: linear-gradient(45deg, #ec4899, #f472b6); -webkit-background-clip: text;"><i class="fas fa-building"></i></div>
                    <h4 class="fw-bold">基本資料建立</h4>
                    <p class="text-muted small">維護公司行號、醫護人員的基本背景資料。 (Index 7)</p>
                </div>
            </div>

            <div class="col-md-6 col-lg-4" id="card-users">
                <div class="card dashboard-card p-4" onclick="window.location.href='admin_users.html'" style="border-left-color: #64748b;">
                    <div class="card-icon" style="background: linear-gradient(45deg, #64748b, #94a3b8); -webkit-background-clip: text;"><i class="fas fa-users-cog"></i></div>
                    <h4 class="fw-bold">帳號權限管理</h4>
                    <p class="text-muted small">系統權限審核、角色分配與帳號狀態監控。 (Admin Only)</p>
                </div>
            </div>

            <div class="col-md-6 col-lg-4" id="card-profile">
                <div class="card dashboard-card p-4" onclick="window.location.href='profile_settings.html'" style="border-left-color: #6366f1;">
                    <div class="card-icon" style="background: linear-gradient(45deg, #6366f1, #818cf8); -webkit-background-clip: text;"><i class="fas fa-user-circle"></i></div>
                    <h4 class="fw-bold">個人帳號設定</h4>
                    <p class="text-muted small">修改密碼、更新個人資料。 (Profile Settings)</p>
                </div>
            </div>

        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 從 sessionStorage 讀取資訊
            const userName = sessionStorage.getItem('currentUserName');
            const userRole = sessionStorage.getItem('currentUserRole');

            if (!userRole) {
                alert('登入逾時，請重新登入。');
                window.location.href = 'login.html';
                return;
            }

            // 顯示畫面並呈現名稱
            document.body.style.display = 'block';
            document.getElementById('display-name').innerText = userName || '使用者';
            document.getElementById('nav-user-name').innerText = (userName || '') + ' (' + userRole + ')';

            // 取得所有功能卡片的 DOM
            const cards = {
                master: document.getElementById('card-master'),   // index1
                manager: document.getElementById('card-manager'), // index2
                eval: document.getElementById('card-eval'),       // index3
                plan: document.getElementById('card-plan'),       // index6
                maint: document.getElementById('card-maint'),     // index7
                users: document.getElementById('card-users'),     // admin_users
                profile: document.getElementById('card-profile')  // profile_settings
            };

            // 權限邏輯控管 (核心修改區)
            
            // 預設動作：先根據角色進行初步過濾
            if (userRole === 'admin') {
                // 管理員：可見所有功能，無需動作
            } 
            else if (userRole === 'medical') {
                // 醫護人員權限
                // 只能看到: index1, profile_settings
                if(cards.manager) cards.manager.style.display = 'none';
                if(cards.eval) cards.eval.style.display = 'none';
                if(cards.plan) cards.plan.style.display = 'none';
                if(cards.maint) cards.maint.style.display = 'none';
                if(cards.users) cards.users.style.display = 'none';
            } 
            else if (userRole === 'doc_control') {
                // General (文管) 權限
                // 只能看到: index1, index3, index7, profile_settings
                if(cards.manager) cards.manager.style.display = 'none';
                if(cards.plan) cards.plan.style.display = 'none';
                if(cards.users) cards.users.style.display = 'none';
            }
            else if (userRole === 'consultant') {
                // 顧問權限 (維持原樣)
                if(cards.manager) cards.manager.style.display = 'none';
                if(cards.eval) cards.eval.style.display = 'none';
                if(cards.plan) cards.plan.style.display = 'none';
                if(cards.maint) cards.maint.style.display = 'none';
                if(cards.users) cards.users.style.display = 'none';
            }
        });

        // 登出功能
        function logout() {
            if(confirm('確定要登出系統嗎？')) {
                sessionStorage.clear();
                window.location.href = 'login.html';
            }
        }

        // 時鐘功能
        setInterval(() => {
            const now = new Date();
            const clock = document.getElementById('current-time');
            if(clock) {
                clock.innerText = now.toLocaleString('zh-TW', { 
                    year: 'numeric', month: '2-digit', day: '2-digit', 
                    hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false 
                });
            }
        }, 1000);
    </script>
</body>
</html>
