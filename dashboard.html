<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>工作儀表板 | OHSMS</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <style>
        :root {
            --primary-bg: #f8f9fa;
            --card-hover-transform: translateY(-5px);
        }

        /* =========================================
           統一頁首/頁尾 CSS 設定 (高度統一版)
           ========================================= */
        html {
            height: 100%; /* 確保根元素高度 */
        }

        body {
            background-color: var(--primary-bg);
            font-family: 'Segoe UI', 'Microsoft JhengHei', sans-serif;
            
            /* 使用 min-height: 100vh 確保背景色至少填滿一頁 */
            min-height: 100vh;
            
            display: none; /* 權限驗證前先隱藏，驗證後透過 JS 改為 flex */
            flex-direction: column; /* 讓內容垂直排列 */
        }

        /* 讓中間的主內容區塊 (container) 自動撐開，將 footer 推到底部 */
        .container, .main-content {
            flex: 1; 
        }

        /* 頁首設定 (深色風格) */
        .navbar {
            background-color: #202124 !important;
            min-height: 85px; /* 統一高度 */
            color: #fff;
            flex-shrink: 0; /* 防止頁首被壓縮 */
        }

        .navbar-brand {
            font-weight: 700;
            letter-spacing: 1px;
            font-size: 1.5rem;
            color: #fff !important;
        }

        /* 頁尾設定 (深色風格 + 置底) */
        footer {
            background-color: #202124 !important;
            color: #fff;
            flex-shrink: 0; /* 防止頁尾被壓縮 */
            
            font-size: 0.9rem;
            letter-spacing: 0.5px;
            
            /* 讓內容垂直居中 */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            
            margin-top: auto; /* 關鍵：確保在內容少時置底 */
            padding: 15px 0;
            min-height: 85px; /* 統一高度 */
        }

        /* =========================================
           儀表板特有樣式
           ========================================= */
        .dashboard-header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 40px 0;
            margin-bottom: 30px;
            border-radius: 0 0 20px 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .function-card {
            border: none;
            border-radius: 15px;
            transition: all 0.3s ease;
            height: 100%;
            background: white;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            overflow: hidden;
            position: relative;
        }

        .function-card:hover {
            transform: var(--card-hover-transform);
            box-shadow: 0 15px 30px rgba(0,0,0,0.1);
        }

        .function-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: #ccc;
        }

        /* 各模組頂部飾條顏色 */
        .card-plan::before { background: #3b82f6; }    /* 1.計畫 (藍) */
        .card-manager::before { background: #10b981; } /* 2.管理 (綠) */
        .card-eval::before { background: #f59e0b; }    /* 3.評估 (橘) */
        .card-service::before { background: #8b5cf6; } /* 4.服務 (紫) */
        .card-act::before { background: #ef4444; }     /* 5.改善 (紅) */
        .card-maint::before { background: #06b6d4; }   /* 6.維護 (青) */
        .card-master::before { background: #4f46e5; }  /* 7.基本 (深藍) */
        .card-users::before { background: #64748b; }   /* Users (灰藍) */
        .card-profile::before { background: #ec4899; } /* Profile (粉紅) */

        .card-icon {
            font-size: 2.5rem;
            margin-bottom: 20px;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f8f9fa;
            transition: all 0.3s;
        }

        .function-card:hover .card-icon {
            background: #eef2ff;
            transform: scale(1.1);
        }

        /* 圖示顏色對應 */
        .icon-plan { color: #3b82f6; }
        .icon-manager { color: #10b981; }
        .icon-eval { color: #f59e0b; }
        .icon-service { color: #8b5cf6; }
        .icon-act { color: #ef4444; }
        .icon-maint { color: #06b6d4; }
        .icon-master { color: #4f46e5; }
        .icon-users { color: #64748b; }
        .icon-profile { color: #ec4899; }

        .card-title {
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 10px;
        }

        .card-desc {
            color: #718096;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .btn-enter {
            margin-top: 20px;
            width: 100%;
            border-radius: 8px;
            padding: 8px;
            font-weight: 600;
            transition: all 0.2s;
        }
        
        /* 隱藏元素用 class */
        .d-none-custom {
            display: none !important;
        }
    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg navbar-dark px-4">
        <div class="container-fluid d-flex justify-content-between align-items-center p-0">
            <a class="navbar-brand d-flex align-items-center" href="dashboard.html">
                <i class="fas fa-shield-alt me-2"></i>
                OHSMS 職安管理系統
            </a>

            <div class="d-flex align-items-center">
                <span class="text-white me-3 small" id="header-date">
                    <i class="fas fa-spinner fa-spin"></i>
                </span>
                
                <span class="text-white me-4 small border-start ps-3 border-secondary" id="header-clock" style="opacity: 0.9;">
                    --:--
                </span>
             
                <span class="text-white me-4 fw-bold" id="header-user">
                    Hi! 使用者
                </span>
                
                <button class="btn btn-outline-light btn-sm" onclick="logoutSystem()">
                    <i class="fas fa-sign-out-alt me-1"></i>登出
                </button>
            </div>
        </div>
    </nav>

    <div class="container pb-5">
        
        <div class="row mb-5">
            <div class="col-12">
                <div class="dashboard-header text-center p-5 rounded-3">
                    <h1 class="fw-bold mb-3">歡迎使用 OHSMS 職安管理系統</h1>
                    <p class="lead mb-0 text-white-50">請選擇下方功能模組開始作業</p>
                </div>
            </div>
        </div>

        <div class="row g-4" id="cards-container">
            
            <div class="col-md-6 col-lg-4" id="card-plan">
                <div class="function-card card-plan p-4 text-center">
                    <div class="d-flex justify-content-center">
                        <div class="card-icon icon-plan"><i class="fas fa-clipboard-list"></i></div>
                    </div>
                    <h5 class="card-title">1. 職業安全衛生計畫</h5>
                    <p class="card-desc">制定年度計畫、目標管理、法規查核與管理績效評估 (Plan)</p>
                    <a href="index1.html" class="btn btn-outline-primary btn-enter">進入模組 <i class="fas fa-arrow-right ms-1"></i></a>
                </div>
            </div>

            <div class="col-md-6 col-lg-4" id="card-manager">
                <div class="function-card card-manager p-4 text-center">
                    <div class="d-flex justify-content-center">
                        <div class="card-icon icon-manager"><i class="fas fa-tasks"></i></div>
                    </div>
                    <h5 class="card-title">2. 安全衛生管理</h5>
                    <p class="card-desc">執行日常管理、巡檢稽核、教育訓練與承攬商管理 (Do)</p>
                    <a href="index2.html" class="btn btn-outline-success btn-enter">進入模組 <i class="fas fa-arrow-right ms-1"></i></a>
                </div>
            </div>

            <div class="col-md-6 col-lg-4" id="card-eval">
                <div class="function-card card-eval p-4 text-center">
                    <div class="d-flex justify-content-center">
                        <div class="card-icon icon-eval"><i class="fas fa-chart-line"></i></div>
                    </div>
                    <h5 class="card-title">3. 績效評估與審查</h5>
                    <p class="card-desc">進行績效監測、內部稽核、事故調查與管理審查 (Check)</p>
                    <a href="index3.html" class="btn btn-outline-warning btn-enter text-dark">進入模組 <i class="fas fa-arrow-right ms-1"></i></a>
                </div>
            </div>

            <div class="col-md-6 col-lg-4" id="card-service">
                <div class="function-card card-service p-4 text-center">
                    <div class="d-flex justify-content-center">
                        <div class="card-icon icon-service"><i class="fas fa-user-md"></i></div>
                    </div>
                    <h5 class="card-title">4. 臨場健康服務</h5>
                    <p class="card-desc">紀錄臨場服務過程、健康指導與各類表單管理 (Service)</p>
                    <a href="index4.html" class="btn btn-outline-info btn-enter text-dark" style="color: #6f42c1; border-color: #6f42c1;">進入模組 <i class="fas fa-arrow-right ms-1"></i></a>
                </div>
            </div>

            <div class="col-md-6 col-lg-4" id="card-act">
                <div class="function-card card-act p-4 text-center">
                    <div class="d-flex justify-content-center">
                        <div class="card-icon icon-act"><i class="fas fa-check-double"></i></div>
                    </div>
                    <h5 class="card-title">5. 改善措施追蹤</h5>
                    <p class="card-desc">針對缺失進行矯正預防、持續改善與追蹤結案 (Act)</p>
                    <a href="index5.html" class="btn btn-outline-danger btn-enter">進入模組 <i class="fas fa-arrow-right ms-1"></i></a>
                </div>
            </div>

            <div class="col-md-6 col-lg-4" id="card-maint">
                <div class="function-card card-maint p-4 text-center">
                    <div class="d-flex justify-content-center">
                        <div class="card-icon icon-maint"><i class="fas fa-cogs"></i></div>
                    </div>
                    <h5 class="card-title">6. 系統維護設定</h5>
                    <p class="card-desc">系統參數設定、備份還原與進階功能維護 (Maintenance)</p>
                    <a href="index6.html" class="btn btn-outline-info btn-enter text-dark">進入模組 <i class="fas fa-arrow-right ms-1"></i></a>
                </div>
            </div>

            <div class="col-md-6 col-lg-4" id="card-master">
                <div class="function-card card-master p-4 text-center">
                    <div class="d-flex justify-content-center">
                        <div class="card-icon icon-master"><i class="fas fa-database"></i></div>
                    </div>
                    <h5 class="card-title">7. 基本資料建立</h5>
                    <p class="card-desc">建立公司、人員、作業場所等 5W1H 基礎資料庫</p>
                    <a href="index7.html" class="btn btn-outline-primary btn-enter" style="border-color: #4f46e5; color: #4f46e5;">進入模組 <i class="fas fa-arrow-right ms-1"></i></a>
                </div>
            </div>

             <div class="col-md-6 col-lg-4" id="card-users">
                <div class="function-card card-users p-4 text-center">
                    <div class="d-flex justify-content-center">
                        <div class="card-icon icon-users"><i class="fas fa-users-cog"></i></div>
                    </div>
                    <h5 class="card-title">帳號權限管理</h5>
                    <p class="card-desc">管理系統使用者帳號、角色指派與權限控管</p>
                    <a href="admin_users.html" class="btn btn-secondary btn-enter">進入管理 <i class="fas fa-arrow-right ms-1"></i></a>
                </div>
            </div>

             <div class="col-md-6 col-lg-4" id="card-profile">
                <div class="function-card card-profile p-4 text-center">
                    <div class="d-flex justify-content-center">
                        <div class="card-icon icon-profile"><i class="fas fa-user-circle"></i></div>
                    </div>
                    <h5 class="card-title">個人資料設定</h5>
                    <p class="card-desc">修改個人基本資料、變更密碼與檢視登入紀錄</p>
                    <a href="profile.html" class="btn btn-outline-dark btn-enter" style="color: #ec4899; border-color: #ec4899;">進入設定 <i class="fas fa-arrow-right ms-1"></i></a>
                </div>
            </div>

        </div>
    </div>

    <footer>
        <div class="mb-1">可信智慧整合有限公司 42917004</div>
        <div class="small opacity-75" style="font-family: 'Segoe UI', sans-serif; letter-spacing: 1px;">
            WesmartAI , Making Trust Transparent.
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 1. 檢查登入狀態
            const userRole = sessionStorage.getItem('currentUserRole');
            const userName = sessionStorage.getItem('currentUserName');

            if (!userRole) {
                alert('未偵測到登入資訊，請重新登入');
                window.location.href = 'login.html';
                return;
            }

            // 2. 更新使用者顯示資訊
            if (userName) {
                document.getElementById('header-user').innerText = `Hi! ${userName}`;
            }

            // 3. 啟動時鐘與日期
            updateClock();
            setInterval(updateClock, 1000);
            updateDate();

            // 4. 顯示頁面 (權限檢查通過後)
            document.body.style.display = 'flex';

            // 5. 根據角色控制卡片顯示
            const cards = {
                plan: document.getElementById('card-plan'),       // 1
                manager: document.getElementById('card-manager'), // 2
                eval: document.getElementById('card-eval'),       // 3
                service: document.getElementById('card-service'), // 4
                act: document.getElementById('card-act'),         // 5
                maint: document.getElementById('card-maint'),     // 6
                master: document.getElementById('card-master'),   // 7
                users: document.getElementById('card-users'),     // Users
                profile: document.getElementById('card-profile')  // Profile
            };

            // 輔助函式
            const hide = (el) => el.classList.add('d-none-custom');
            const show = (el) => el.classList.remove('d-none-custom');

            // ----------------------------------------------------
            // 權限邏輯對照表
            // ----------------------------------------------------
            if (userRole === 'admin') {
                // Admin: 全開
                Object.values(cards).forEach(show);
            } 
            else if (userRole === 'doc_control') {
                // Doc_control: 1, 2, 3, 4, 5, 6, 7, users, profile
                // ★ 修改：允許文管人員存取 users (帳號權限管理)
                show(cards.plan);      // 1
                show(cards.manager);   // 2
                show(cards.eval);      // 3
                show(cards.service);   // 4 
                hide(cards.act);       // 5 
                show(cards.maint);     // 6
                show(cards.master);    // 7
                show(cards.users);     // Users (★ 已設為顯示)
                show(cards.profile);   // Profile
            }
            else if (userRole === 'consultant') {
                // Consultant: 1, 5, profile, 4 (隱藏 2, 3, 6, 7, users)
                show(cards.plan);      // 1
                hide(cards.manager);   // 2
                hide(cards.eval);      // 3
                show(cards.act);       // 5 
                hide(cards.maint);     // 6
                hide(cards.master);    // 7
                hide(cards.users);     // Users
                show(cards.profile);   // Profile
                show(cards.service);   // 4
            }
        });

        // ------------------------------------------
        // 功能函式
        // ------------------------------------------
        function logoutSystem() {
            if(confirm('確定要登出系統嗎？')) {
                sessionStorage.clear();
                window.location.href = 'login.html';
            }
        }

        function updateClock() {
            const now = new Date();
            const clockEl = document.getElementById('header-clock');
            if(clockEl) {
                clockEl.textContent = now.toLocaleTimeString('zh-TW', { hour12: false });
            }
        }

        function updateDate() {
            const dateEl = document.getElementById('header-date');
            if(dateEl) {
                const now = new Date();
                const days = ['日', '一', '二', '三', '四', '五', '六'];
                const formattedDate = `${now.getFullYear()}/${now.getMonth() + 1}/${now.getDate()}(${days[now.getDay()]})`;
                dateEl.innerHTML = `<i class="far fa-calendar-alt me-1"></i>今日是 ${formattedDate}`;
            }
        }
    </script>
</body>
</html>
