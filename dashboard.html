<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WesmartAI - OHSMS 職安管理系統儀表板</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <style>
        /* =========================================
           統一頁首/頁尾 CSS 設定
           ========================================= */
        html, body {
            height: 100%;
        }

        body {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            background-color: #f8f9fa;
            font-family: 'Segoe UI', 'Microsoft JhengHei', sans-serif;
        }

        .main-content {
            flex: 1;
        }

        /* 頁首設定 */
        .navbar {
            background-color: #202124 !important;
            min-height: 85px;
            color: #fff;
            flex-shrink: 0;
        }

        /* 頁尾設定 */
        footer {
            background-color: #202124 !important;
            color: #fff;
            flex-shrink: 0;
            font-size: 0.9rem;
            letter-spacing: 0.5px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin-top: auto;
            padding: 15px 0;
            min-height: 85px;
        }

        /* 儀表板卡片特效 */
        .module-card {
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
        }
        .module-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1) !important;
        }
        .module-card:hover .btn {
            background-color: var(--bs-primary);
            color: white;
            border-color: var(--bs-primary);
        }

        /* 客製化各模組的 Hover 邊框色 */
        .card-system:hover { border-left-color: #6c757d; }
        .card-data:hover { border-left-color: #0d6efd; }
        .card-cases:hover { border-left-color: #198754; }
        .card-eval:hover { border-left-color: #ffc107; }
        .card-ai:hover { border-left-color: #0dcaf0; }
        .card-log:hover { border-left-color: #d63384; }
        .card-files:hover { border-left-color: #fd7e14; }
        /* 新增：補件管理的 Hover 邊框色 (紅色) */
        .card-improve:hover { border-left-color: #dc3545; }

        /* 隱藏無權限模組 */
        .d-none-role {
            display: none !important;
        }
    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg navbar-dark px-4">
        <div class="container-fluid d-flex justify-content-between align-items-center p-0">
            <a class="navbar-brand d-flex align-items-center fw-bold" href="#">
                <i class="fas fa-shield-alt me-2"></i> OHSMS 職安管理系統
            </a>
            <div class="d-flex align-items-center">
                <span class="text-white me-3 small" id="header-date"><i class="fas fa-spinner fa-spin"></i></span>
                <span class="text-white me-4 small border-start ps-3 border-secondary" id="header-clock" style="opacity: 0.9;">--:--</span>
                <span class="text-white me-4 fw-bold" id="header-user">Hi! 讀取中...</span>
                <span class="badge bg-secondary me-4" id="header-role">權限</span>
                <button class="btn btn-outline-light btn-sm" onclick="logout()"><i class="fas fa-sign-out-alt me-1"></i>登出</button>
            </div>
        </div>
    </nav>

    <div class="container main-content mt-5 px-4 pb-5">
        
        <div class="mb-5 text-center">
            <h2 class="fw-bold text-dark mb-2">系統模組導航</h2>
            <p class="text-secondary">請依據您的權限選擇欲進入之工作站</p>
        </div>

        <div class="row g-4" id="modules-container">
            
            <div class="col-md-4 mb-4" data-role="admin">
                <div class="card module-card card-system shadow-sm h-100 border-0">
                    <div class="card-body p-4 d-flex flex-column">
                        <div class="d-flex align-items-center mb-3">
                            <div class="rounded-circle bg-secondary bg-opacity-10 p-3 me-3 text-secondary">
                                <i class="fas fa-users-cog fa-2x"></i>
                            </div>
                            <h5 class="card-title fw-bold m-0 text-dark">系統設定管理</h5>
                        </div>
                        <p class="card-text text-secondary mb-4 flex-grow-1">
                            帳號權限管理、系統參數設定與全域配置。
                        </p>
                        <a href="users_management.html" class="btn btn-outline-secondary w-100 fw-bold">
                            <i class="fas fa-sign-in-alt me-1"></i>進入設定
                        </a>
                    </div>
                </div>
            </div>

            <div class="col-md-4 mb-4" data-role="admin,data_entry,consultant">
                <div class="card module-card card-data shadow-sm h-100 border-0">
                    <div class="card-body p-4 d-flex flex-column">
                        <div class="d-flex align-items-center mb-3">
                            <div class="rounded-circle bg-primary bg-opacity-10 p-3 me-3 text-primary">
                                <i class="fas fa-database fa-2x"></i>
                            </div>
                            <h5 class="card-title fw-bold m-0 text-dark">基本資料建檔 (Plan)</h5>
                        </div>
                        <p class="card-text text-secondary mb-4 flex-grow-1">
                            企業名冊、顧問名單與年度評鑑計畫之建置與維護。
                        </p>
                        <a href="index1.html" class="btn btn-outline-primary w-100 fw-bold">
                            <i class="fas fa-sign-in-alt me-1"></i>進入建檔
                        </a>
                    </div>
                </div>
            </div>

            <div class="col-md-4 mb-4" data-role="admin,consultant">
                <div class="card module-card card-cases shadow-sm h-100 border-0">
                    <div class="card-body p-4 d-flex flex-column">
                        <div class="d-flex align-items-center mb-3">
                            <div class="rounded-circle bg-success bg-opacity-10 p-3 me-3 text-success">
                                <i class="fas fa-list-check fa-2x"></i>
                            </div>
                            <h5 class="card-title fw-bold m-0 text-dark">案件與軌跡管理 (Do)</h5>
                        </div>
                        <p class="card-text text-secondary mb-4 flex-grow-1">
                            登錄服務軌跡、上傳佐證資料並建構完整 5W1H 證據鏈。
                        </p>
                        <a href="index2.html" class="btn btn-outline-success w-100 fw-bold">
                            <i class="fas fa-sign-in-alt me-1"></i>進入管理
                        </a>
                    </div>
                </div>
            </div>

            <div class="col-md-4 mb-4" data-role="admin,reviewer,consultant">
                <div class="card module-card card-eval shadow-sm h-100 border-0">
                    <div class="card-body p-4 d-flex flex-column">
                        <div class="d-flex align-items-center mb-3">
                            <div class="rounded-circle bg-warning bg-opacity-10 p-3 me-3 text-warning">
                                <i class="fas fa-shield-alt fa-2x"></i>
                            </div>
                            <h5 class="card-title fw-bold m-0 text-dark">評鑑 AI 助理 (Check)</h5>
                        </div>
                        <p class="card-text text-secondary mb-4 flex-grow-1">
                            檢索與驗證服務軌跡、調閱證據並寫入防篡改審查紀錄。
                        </p>
                        <a href="index3.html" class="btn btn-outline-warning w-100 fw-bold">
                            <i class="fas fa-sign-in-alt me-1"></i>進入評鑑
                        </a>
                    </div>
                </div>
            </div>

            <div class="col-md-4 mb-4" data-role="admin,consultant">
                <div class="card module-card card-improve shadow-sm h-100 border-0">
                    <div class="card-body p-4 d-flex flex-column">
                        <div class="d-flex align-items-center mb-3">
                            <div class="rounded-circle bg-danger bg-opacity-10 p-3 me-3 text-danger">
                                <i class="fas fa-file-signature fa-2x"></i>
                            </div>
                            <h5 class="card-title fw-bold m-0 text-dark">顧問補件管理 (Action)</h5>
                        </div>
                        <p class="card-text text-secondary mb-4 flex-grow-1">
                            針對系統稽核或評鑑委員指出之缺失進行修補，落實 PDCA 改善階段。
                        </p>
                        <style> .card-improve:hover .btn { background-color: #dc3545; border-color: #dc3545; } </style>
                        <a href="index5.html" class="btn btn-outline-danger w-100 fw-bold">
                            <i class="fas fa-sign-in-alt me-1"></i>進入補件中心
                        </a>
                    </div>
                </div>
            </div>

            <div class="col-md-4 mb-4" data-role="admin,consultant,reviewer">
                <div class="card module-card card-ai shadow-sm h-100 border-0">
                    <div class="card-body p-4 d-flex flex-column">
                        <div class="d-flex align-items-center mb-3">
                            <div class="rounded-circle bg-info bg-opacity-10 p-3 me-3 text-info">
                                <i class="fas fa-robot fa-2x"></i>
                            </div>
                            <h5 class="card-title fw-bold m-0 text-dark">AI 職安法規顧問</h5>
                        </div>
                        <p class="card-text text-secondary mb-4 flex-grow-1">
                            即時查詢最新勞動法規、職安標準與評鑑指引。
                        </p>
                        <a href="index4.html" class="btn btn-outline-info w-100 fw-bold">
                            <i class="fas fa-sign-in-alt me-1"></i>諮詢 AI
                        </a>
                    </div>
                </div>
            </div>

            <div class="col-md-4 mb-4" data-role="admin,data_entry">
                <div class="card module-card card-files shadow-sm h-100 border-0">
                    <div class="card-body p-4 d-flex flex-column">
                        <div class="d-flex align-items-center mb-3">
                            <div class="rounded-circle p-3 me-3" style="background-color: rgba(253, 126, 20, 0.1); color: #fd7e14;">
                                <i class="fas fa-file-import fa-2x"></i>
                            </div>
                            <h5 class="card-title fw-bold m-0 text-dark">檔案批次管理</h5>
                        </div>
                        <p class="card-text text-secondary mb-4 flex-grow-1">
                            大批次上傳證據檔案、自動歸檔與目錄結構維護。
                        </p>
                        <a href="file_manager.html" class="btn w-100 fw-bold" style="color: #fd7e14; border-color: #fd7e14;">
                            <i class="fas fa-sign-in-alt me-1"></i>進入管理
                        </a>
                    </div>
                </div>
            </div>

            <div class="col-md-4 mb-4" data-role="admin">
                <div class="card module-card card-log shadow-sm h-100 border-0">
                    <div class="card-body p-4 d-flex flex-column">
                        <div class="d-flex align-items-center mb-3">
                            <div class="rounded-circle p-3 me-3" style="background-color: rgba(214, 51, 132, 0.1); color: #d63384;">
                                <i class="fas fa-history fa-2x"></i>
                            </div>
                            <h5 class="card-title fw-bold m-0 text-dark">系統稽核日誌</h5>
                        </div>
                        <p class="card-text text-secondary mb-4 flex-grow-1">
                            檢視所有登入紀錄、操作軌跡與防篡改區塊鏈日誌。
                        </p>
                        <a href="system_logs.html" class="btn w-100 fw-bold" style="color: #d63384; border-color: #d63384;">
                            <i class="fas fa-sign-in-alt me-1"></i>檢視日誌
                        </a>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <footer>
        <div class="mb-1">可信智慧整合有限公司 42917004</div>
        <div class="small opacity-75" style="font-family: 'Segoe UI', sans-serif; letter-spacing: 1px;">
            WesmartAI , Making Trust Transparent.
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // 時間處理
            setInterval(() => {
                const now = new Date();
                document.getElementById('header-clock').textContent = now.toLocaleTimeString('zh-TW', { hour12: false });
            }, 1000);

            const now = new Date();
            const days = ['日', '一', '二', '三', '四', '五', '六'];
            document.getElementById('header-date').innerHTML = `<i class="far fa-calendar-alt me-1"></i>今日是 ${now.getFullYear()}/${now.getMonth() + 1}/${now.getDate()}(${days[now.getDay()]})`;

            // 權限與身分驗證
            const userJson = sessionStorage.getItem('wesmart_user');
            if (!userJson) {
                alert('登入已逾時，請重新登入。');
                window.location.href = 'index.html';
                return;
            }

            const user = JSON.parse(userJson);
            document.getElementById('header-user').innerText = `Hi! ${user.name}`;
            
            // 翻譯權限名稱
            const roleNames = {
                'admin': '系統管理員',
                'consultant': '醫護顧問',
                'data_entry': '資料建檔員',
                'reviewer': '評鑑委員'
            };
            document.getElementById('header-role').innerText = roleNames[user.role] || user.role;

            // --- 核心：根據 Role 篩選顯示模組 ---
            const userRole = user.role; 
            const modules = document.querySelectorAll('#modules-container > div[data-role]');

            modules.forEach(module => {
                const allowedRoles = module.getAttribute('data-role').split(',');
                if (!allowedRoles.includes(userRole)) {
                    module.classList.add('d-none-role');
                }
            });
        });

        // 登出
        function logout() {
            if (confirm('確定要登出系統嗎？')) {
                sessionStorage.clear();
                window.location.href = 'index.html';
            }
        }
    </script>
</body>
</html>
